module.exports=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.TypeormStore=n.TypeormStore},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}c((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){c.label=r[1];break}if(6===r[0]&&c.label<s[1]){c.label=s[1],s=r;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(r);break}s[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(e){r=[6,e],i=0}finally{o=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,s,u,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),u=function(e){function t(t){var r=e.call(this,t)||this;if(!t.sessionService)throw new Error("The session service option is required");if(!t.userService)throw new Error("The user service option is required");return r.sessionService=t.sessionService,r.userService=t.userService,r.database=t.database,r.ttl=t.ttl,r}return n(t,e),t.prototype.all=function(e){this.sessionService.find().then(function(e){return e.map(function(e){return{cookie:JSON.parse(e.cookie),authorize:JSON.parse(e.authorize),passport:JSON.parse(e.passport)}})}).then(function(t){return e(null,t)}).catch(function(t){return e(t)})},t.prototype.destroy=function(e,t){this.sessionService.delete(e).then(function(){return t(null)}).catch(function(e){return t(e)})},t.prototype.clear=function(e){this.sessionService.clear().then(function(){return e(null)}).catch(function(t){return e(t)})},t.prototype.length=function(e){this.sessionService.count().then(function(t){return e(null,t)}).catch(function(t){return e(t,0)})},t.prototype.get=function(e,t){var r=this;this.sessionService.findOne({where:{sid:e}}).then(function(e){return o(r,void 0,void 0,function(){var r;return i(this,function(n){return r={},e&&e.cookie&&(r.cookie=JSON.parse(e.cookie)),e&&e.authorize&&(r.authorize=JSON.parse(e.authorize)),e&&e.passport&&(r.passport=JSON.parse(e.passport)),Object.keys(r).length?[2,t(null,r)]:[2,t(null)]})})}).catch(function(e){return t(e)})},t.prototype.set=function(e,t,r){return o(this,void 0,void 0,function(){var n,o,s,u;return i(this,function(i){switch(i.label){case 0:return n=this.getTTL(t),o=Math.floor((new Date).getTime()/1e3)+n,[4,this.sessionService.findOne({sid:e})];case 1:s=i.sent()||{},s.sid||(s.sid=e),s.user=null;try{t&&t.cookie&&(s.cookie=JSON.stringify(t.cookie)),t&&t.passport&&(s.passport=JSON.stringify(t.passport)),t&&t.authorize&&(s.authorize=JSON.stringify(t.authorize))}catch(e){return[2,r(e)]}return s.expiresAt=o,t.passport&&t.passport.user?(u=s,[4,this.userService.findOne(t.passport.user.id)]):[3,3];case 2:u.user=i.sent(),i.label=3;case 3:return s.id?this.sessionService.update({sid:e},s).then(function(){return r(null)}).catch(function(e){return r(e)}):this.sessionService.save(s).then(function(){return r(null)}).catch(function(e){return r(e)}),[2]}})})},t.prototype.touch=function(e,t,r){var n=this.getTTL(t),o=Math.floor((new Date).getTime()/1e3)+n;this.sessionService.update({sid:e},{expiresAt:o}).then(function(){return r(null)}).catch(function(e){return r(e)})},t.prototype.getTTL=function(e){return this.ttl?this.ttl:e.cookie&&e.cookie.maxAge?Math.floor(e.cookie.maxAge/1e3):86400},t}(s.Store);t.TypeormStore=u},function(e,t){e.exports=require("express-session")}]);