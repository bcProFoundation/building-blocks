module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.TypeormStore=n.TypeormStore},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(u,s)}c((n=n.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;if(!t.sessionService)throw new Error("The session service option is required");if(!t.userService)throw new Error("The user service option is required");return r.sessionService=t.sessionService,r.userService=t.userService,r.database=t.database,r.ttl=t.ttl,r}return o(t,e),t.prototype.all=function(e){this.sessionService.find().then(function(e){return e.map(function(e){return{cookie:JSON.parse(e.cookie),authorize:JSON.parse(e.authorize),passport:JSON.parse(e.passport)}})}).then(function(t){return e(null,t)}).catch(function(t){return e(t)})},t.prototype.destroy=function(e,t){this.sessionService.delete(e).then(function(){return t(null)}).catch(function(e){return t(e)})},t.prototype.clear=function(e){this.sessionService.clear().then(function(){return e(null)}).catch(function(t){return e(t)})},t.prototype.length=function(e){this.sessionService.count().then(function(t){return e(null,t)}).catch(function(t){return e(t,0)})},t.prototype.get=function(e,t){var r=this;this.sessionService.findOne({where:{sid:e}}).then(function(e){return i(r,void 0,void 0,function(){var r;return u(this,function(n){return r={},e&&e.cookie&&(r.cookie=JSON.parse(e.cookie)),e&&e.authorize&&(r.authorize=JSON.parse(e.authorize)),e&&e.passport&&(r.passport=JSON.parse(e.passport)),Object.keys(r).length?[2,t(null,r)]:[2,t(null)]})})}).catch(function(e){return t(e)})},t.prototype.set=function(e,t,r){return i(this,void 0,void 0,function(){var n,o,i,s;return u(this,function(u){switch(u.label){case 0:return n=this.getTTL(t),o=Math.floor((new Date).getTime()/1e3)+n,[4,this.sessionService.findOne({sid:e})];case 1:(i=u.sent()||{}).sid||(i.sid=e),i.user=null;try{t&&t.cookie&&(i.cookie=JSON.stringify(t.cookie)),t&&t.passport&&(i.passport=JSON.stringify(t.passport)),t&&t.authorize&&(i.authorize=JSON.stringify(t.authorize))}catch(e){return[2,r(e)]}return i.expiresAt=o,t.passport&&t.passport.user?(s=i,[4,this.userService.findOne(t.passport.user.id)]):[3,3];case 2:s.user=u.sent(),u.label=3;case 3:return i.id?this.sessionService.update({sid:e},i).then(function(){return r(null)}).catch(function(e){return r(e)}):this.sessionService.save(i).then(function(){return r(null)}).catch(function(e){return r(e)}),[2]}})})},t.prototype.touch=function(e,t,r){var n=this.getTTL(t),o=Math.floor((new Date).getTime()/1e3)+n;this.sessionService.update({sid:e},{expiresAt:o}).then(function(){return r(null)}).catch(function(e){return r(e)})},t.prototype.getTTL=function(e){return this.ttl?this.ttl:e.cookie&&e.cookie.maxAge?Math.floor(e.cookie.maxAge/1e3):86400},t}(r(2).Store);t.TypeormStore=s},function(e,t){e.exports=require("express-session")}]);