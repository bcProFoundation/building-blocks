image: castlecraft/node-latest-headless-chrome:1.0

stages:
  - tests

test_async:
  stage: tests
  before_script:
   # Launch Xvfb
   - Xvfb :0 -ac -screen 0 1024x768x24 &
   # Export display for Chrome
   - export DISPLAY=:99
  script:
   - npm install -g lerna
   - yarn clean
   - lerna bootstrap
   - export NODE_ENV=test
   - yarn lint
   - yarn test
   - yarn test:e2e
  tags:
    - docker
